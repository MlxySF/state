<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 WSA Wushu Registration | Enrollment Form</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- jsPDF + html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            background: radial-gradient(circle at top right, #1e293b, #0f172a);
            min-height: 100vh;
            padding: 20px;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            max-width: 800px;
            margin: 0 auto;
            border-radius: 24px;
            overflow: hidden;
        }

        .step-content {
            display: none;
            animation: fadeIn 0.4s ease-in-out;
        }
        .step-content.active { display: block; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }

        /* Signature Box */
        .sig-box {
            position: relative;
            width: 100%;
            height: 200px;
            border: 2px dashed #cbd5e1;
            border-radius: 0.75rem;
            background: #fff;
            overflow: hidden;
            touch-action: none;
        }

        #sig-placeholder {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #cbd5e1;
            font-size: 24px;
            font-weight: 700;
            pointer-events: none;
            user-select: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Status Radio Styling */
        input[type="radio"][name="status"] {
            display: none;
        }

        .status-option {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        /* Custom Checkbox */
        .custom-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            cursor: pointer;
            padding: 12px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .custom-checkbox:hover {
            background-color: #f8fafc;
        }

        .custom-checkbox input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            min-width: 20px;
            border: 2px solid #cbd5e1;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
            margin-top: 2px;
        }

        .custom-checkbox input[type="checkbox"]:hover {
            border-color: #fbbf24;
        }

        .custom-checkbox input[type="checkbox"]:checked {
            background-color: #7c3aed;
            border-color: #7c3aed;
        }

        .custom-checkbox input[type="checkbox"]:checked::after {
            content: '';
            position: absolute;
            left: 5px;
            top: 2px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        .custom-checkbox-label {
            flex: 1;
            line-height: 1.5;
        }

        /* School Box Styles */
        .school-box {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            background: white;
            margin-bottom: 16px;
        }

        .school-box:hover {
            border-color: #fbbf24;
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.15);
        }

        .school-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            cursor: pointer;
            background: #f8fafc;
            transition: background 0.2s;
        }

        .school-header:hover {
            background: #f1f5f9;
        }

        .school-info {
            display: flex;
            align-items: center;
            gap: 16px;
            flex: 1;
        }

        .school-logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #e2e8f0;
            flex-shrink: 0;
        }

        .school-text h3 {
            font-size: 16px;
            font-weight: 700;
            color: #1e293b;
            margin: 0 0 4px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .school-text p {
            font-size: 13px;
            color: #64748b;
            margin: 0;
        }

        .school-toggle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .school-toggle i {
            transition: transform 0.3s;
            color: #475569;
        }

        .school-box.active .school-toggle {
            background: #fbbf24;
        }

        .school-box.active .school-toggle i {
            transform: rotate(180deg);
            color: white;
        }

        .school-schedules {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .school-schedules-inner {
            padding: 0 20px 20px 20px;
        }

        .school-box.active .school-schedules {
            max-height: 1000px;
        }

        /* PDF Templates */
        #pdf-template-page1, #pdf-template-page2 {
            position: fixed !important;
            left: -99999px !important;
            top: -99999px !important;
            width: 794px;
            padding: 40px;
            background: #ffffff;
            visibility: hidden;
            opacity: 0;
            pointer-events: none;
            z-index: -9999;
        }
    </style>
</head>
<body>

<div class="glass-card">
    
    <!-- Header -->
    <div style="background: #1e293b; color: white; padding: 24px; border-bottom: 4px solid #fbbf24;">
        <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 8px;">
            <div>
                <h1 style="font-size: 24px; font-weight: bold; background: linear-gradient(to right, #fde68a, #fbbf24); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 4px;">
                    2026 武术训练报名
                </h1>
                <p style="color: #94a3b8; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">Official Registration Form</p>
            </div>
            <div style="color: #fbbf24; font-weight: bold; font-size: 20px;" id="step-counter">
                01<span style="color: #475569; font-size: 14px;">/06</span>
            </div>
        </div>
        <div style="width: 100%; background: #475569; height: 6px; border-radius: 999px; overflow: hidden; margin-top: 8px;">
            <div id="progress-bar" style="height: 100%; background: #fbbf24; transition: width 0.5s ease; width: 16.66%;"></div>
        </div>
    </div>

    <!-- Form Body -->
    <div style="padding: 32px; background: #f8fafc; max-height: 70vh; overflow-y: auto;" class="custom-scroll">
        <form id="regForm" onsubmit="return false;">

            <!-- STEP 1: Basic Info -->
            <div id="step-1" class="step-content active">
                <h2 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                    <i class="fa-solid fa-user-graduate text-amber-500"></i> 基本资料 Student Details
                </h2>
                <div class="space-y-6">
                    <!-- Name Row -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-slate-500 uppercase">Chinese Name 中文名</label>
                            <input type="text" id="name-cn" class="w-full p-3 rounded-xl border border-slate-300 focus:border-amber-500 outline-none" placeholder="张三">
                        </div>
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-slate-500 uppercase">English Name 英文名 *</label>
                            <input type="text" id="name-en" class="w-full p-3 rounded-xl border border-slate-300 focus:border-amber-500 outline-none" placeholder="Tan Ah Meng" required>
                        </div>
                    </div>

                    <!-- IC and Age Row -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-slate-500 uppercase">IC Number 身份证号码 *</label>
                            <input type="text" id="ic" class="w-full p-3 rounded-xl border border-slate-300 focus:border-amber-500 outline-none" placeholder="000000-00-0000" maxlength="14" required>
                            <p class="text-xs text-slate-400">Format: 000000-00-0000</p>
                        </div>
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-slate-500 uppercase">Age 年龄 (2026)</label>
                            <input type="number" id="age" class="w-full p-3 rounded-xl border border-slate-300 bg-slate-100 text-slate-500 cursor-not-allowed outline-none" placeholder="Auto-calculated" readonly>
                            <p class="text-xs text-slate-400">
                                <i class="fas fa-info-circle mr-1"></i>Calculated from IC
                            </p>
                        </div>
                    </div>

                    <!-- School Row -->
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-500 uppercase">School 学校 *</label>
                        <select id="school" class="w-full p-3 rounded-xl border border-slate-300 focus:border-amber-500 outline-none bg-white" required>
                            <option value="">Select School...</option>
                            <option value="SJK(C) PUAY CHAI 2">SJK(C) PUAY CHAI 2 (培才二校)</option>
                            <option value="SJK(C) Chee Wen">SJK(C) Chee Wen</option>
                            <option value="SJK(C) Subang">SJK(C) Subang</option>
                            <option value="SJK(C) Sin Ming">SJK(C) Sin Ming</option>
                            <option value="Others">Others (其他)</option>
                        </select>
                        <input type="text" id="school-other" class="hidden w-full mt-2 p-3 rounded-xl border border-slate-300 focus:border-amber-500 outline-none" placeholder="Please specify school name">
                    </div>
                </div>
            </div>

            <!-- STEP 2: Contact -->
            <div id="step-2" class="step-content">
                <h2 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                    <i class="fa-solid fa-address-card text-amber-500"></i> 联系方式 Contact Info
                </h2>
                <div class="space-y-5">
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-500 uppercase">Phone Number 电话号码 *</label>
                        <div class="relative">
                            <i class="fa-solid fa-phone absolute left-4 top-4 text-slate-400"></i>
                            <input type="tel" id="phone" class="w-full pl-10 p-3 rounded-xl border border-slate-300 focus:border-amber-500 outline-none" placeholder="012-345 6789" maxlength="13" required>
                        </div>
                        <p class="text-xs text-slate-400">Format: 012-345 6789 or 011-2345 6789</p>
                    </div>

                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-500 uppercase">Parent's Email 家长邮箱 *</label>
                        <div class="relative">
                            <i class="fa-solid fa-envelope absolute left-4 top-4 text-slate-400"></i>
                            <input type="email" id="email" class="w-full pl-10 p-3 rounded-xl border border-slate-300 focus:border-amber-500 outline-none" placeholder="parent@example.com" required>
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-500 uppercase">Student Status 身份 *</label>
                        <div class="grid grid-cols-3 gap-3">
                            <label class="cursor-pointer">
                                <input type="radio" name="status" value="Student 学生" class="status-radio" checked>
                                <div class="status-option p-3 text-center rounded-xl border border-slate-200 bg-white">
                                    Student<br>学生
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="status" value="State Team 州队" class="status-radio">
                                <div class="status-option p-3 text-center rounded-xl border border-slate-200 bg-white">
                                    State Team<br>州队
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="status" value="Others 其他" class="status-radio">
                                <div class="status-option p-3 text-center rounded-xl border border-slate-200 bg-white">
                                    Others<br>其他
                                </div>
                            </label>
                        </div>
                        <input type="text" id="status-other" class="hidden w-full mt-2 p-3 rounded-xl border border-slate-300 focus:border-amber-500 outline-none" placeholder="Please specify status">
                    </div>
                </div>
            </div>

            <!-- STEP 3: Training Level -->
            <div id="step-3" class="step-content">
                <h2 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                    <i class="fa-solid fa-ranking-star text-amber-500"></i> 训练等级 Training Level
                </h2>
                <div class="space-y-6">
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-500 uppercase">Current Training Level 当前训练等级 *</label>
                        <select id="level" class="w-full p-3 rounded-xl border border-slate-300 focus:border-amber-500 outline-none bg-white" required>
                            <option value="">Select Level...</option>
                            <option value="Beginner 初级">Beginner 初级</option>
                            <option value="Intermediate 中级">Intermediate 中级</option>
                            <option value="Advanced 高级">Advanced 高级</option>
                            <option value="State Team 州队">State Team 州队</option>
                            <option value="National Team 国队">National Team 国队</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- STEP 4: Events -->
            <div id="step-4" class="step-content">
                <h2 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                    <i class="fa-solid fa-calendar-check text-amber-500"></i> 比赛项目 Event Selection
                </h2>
                <div class="space-y-4">
                    <label class="text-xs font-bold text-slate-500 uppercase">Select Events 选择项目 *</label>
                    <p class="text-sm text-slate-600">Choose at least one event</p>
                    <div class="space-y-3">
                        <label class="custom-checkbox">
                            <input type="checkbox" name="events" value="Changquan 长拳">
                            <span class="custom-checkbox-label">Changquan 长拳</span>
                        </label>
                        <label class="custom-checkbox">
                            <input type="checkbox" name="events" value="Nanquan 南拳">
                            <span class="custom-checkbox-label">Nanquan 南拳</span>
                        </label>
                        <label class="custom-checkbox">
                            <input type="checkbox" name="events" value="Taijiquan 太极拳">
                            <span class="custom-checkbox-label">Taijiquan 太极拳</span>
                        </label>
                        <label class="custom-checkbox">
                            <input type="checkbox" name="events" value="Daoshu 刀术">
                            <span class="custom-checkbox-label">Daoshu 刀术</span>
                        </label>
                        <label class="custom-checkbox">
                            <input type="checkbox" name="events" value="Jianshu 剑术">
                            <span class="custom-checkbox-label">Jianshu 剑术</span>
                        </label>
                        <label class="custom-checkbox">
                            <input type="checkbox" name="events" value="Gunshu 棍术">
                            <span class="custom-checkbox-label">Gunshu 棍术</span>
                        </label>
                        <label class="custom-checkbox">
                            <input type="checkbox" name="events" value="Qiangshu 枪术">
                            <span class="custom-checkbox-label">Qiangshu 枪术</span>
                        </label>
                        <label class="custom-checkbox">
                            <input type="checkbox" name="events" value="Duilian 对练">
                            <span class="custom-checkbox-label">Duilian 对练</span>
                        </label>
                        <label class="custom-checkbox">
                            <input type="checkbox" name="events" value="Jiti 集体">
                            <span class="custom-checkbox-label">Jiti 集体</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- STEP 5: Schedule -->
            <div id="step-5" class="step-content">
                <h2 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                    <i class="fa-solid fa-school text-amber-500"></i> 训练时间 Training Schedule
                </h2>
                <div class="space-y-4">
                    <label class="text-xs font-bold text-slate-500 uppercase">Select Training Schedule 选择训练时间 *</label>
                    <p class="text-sm text-slate-600">Choose your preferred training location and time</p>
                    
                    <!-- School Box 1 -->
                    <div class="school-box" onclick="toggleSchoolBox(this)">
                        <div class="school-header">
                            <div class="school-info">
                                <img src="https://i.imgur.com/BG6ZsGJ.jpg" alt="Puay Chai 2" class="school-logo">
                                <div class="school-text">
                                    <h3>培才二校 SJK(C) Puay Chai 2</h3>
                                    <p>Monday & Wednesday • 3:00 PM - 5:00 PM</p>
                                </div>
                            </div>
                            <div class="school-toggle">
                                <i class="fa-solid fa-chevron-down"></i>
                            </div>
                        </div>
                        <div class="school-schedules">
                            <div class="school-schedules-inner">
                                <label class="custom-checkbox">
                                    <input type="checkbox" name="schedule" value="Puay Chai 2 - Mon/Wed (3-5pm)">
                                    <span class="custom-checkbox-label">
                                        <strong>Regular Training</strong><br>
                                        Monday & Wednesday • 3:00 PM - 5:00 PM
                                    </span>
                                </label>
                                <label class="custom-checkbox">
                                    <input type="checkbox" name="schedule" value="Puay Chai 2 - Sat (9-11am)">
                                    <span class="custom-checkbox-label">
                                        <strong>Weekend Training</strong><br>
                                        Saturday • 9:00 AM - 11:00 AM
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- School Box 2 -->
                    <div class="school-box" onclick="toggleSchoolBox(this)">
                        <div class="school-header">
                            <div class="school-info">
                                <img src="https://i.imgur.com/k0rjkKx.jpg" alt="Chee Wen" class="school-logo">
                                <div class="school-text">
                                    <h3>智文小学 SJK(C) Chee Wen</h3>
                                    <p>Tuesday & Thursday • 3:00 PM - 5:00 PM</p>
                                </div>
                            </div>
                            <div class="school-toggle">
                                <i class="fa-solid fa-chevron-down"></i>
                            </div>
                        </div>
                        <div class="school-schedules">
                            <div class="school-schedules-inner">
                                <label class="custom-checkbox">
                                    <input type="checkbox" name="schedule" value="Chee Wen - Tue/Thu (3-5pm)">
                                    <span class="custom-checkbox-label">
                                        <strong>Regular Training</strong><br>
                                        Tuesday & Thursday • 3:00 PM - 5:00 PM
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- School Box 3 -->
                    <div class="school-box" onclick="toggleSchoolBox(this)">
                        <div class="school-header">
                            <div class="school-info">
                                <img src="https://i.imgur.com/7XG2i9J.jpg" alt="Subang" class="school-logo">
                                <div class="school-text">
                                    <h3>梳邦学校 SJK(C) Subang</h3>
                                    <p>Wednesday & Friday • 3:00 PM - 5:00 PM</p>
                                </div>
                            </div>
                            <div class="school-toggle">
                                <i class="fa-solid fa-chevron-down"></i>
                            </div>
                        </div>
                        <div class="school-schedules">
                            <div class="school-schedules-inner">
                                <label class="custom-checkbox">
                                    <input type="checkbox" name="schedule" value="Subang - Wed/Fri (3-5pm)">
                                    <span class="custom-checkbox-label">
                                        <strong>Regular Training</strong><br>
                                        Wednesday & Friday • 3:00 PM - 5:00 PM
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- School Box 4 -->
                    <div class="school-box" onclick="toggleSchoolBox(this)">
                        <div class="school-header">
                            <div class="school-info">
                                <img src="https://i.imgur.com/XqDkqzm.jpg" alt="Sin Ming" class="school-logo">
                                <div class="school-text">
                                    <h3>新明小学 SJK(C) Sin Ming</h3>
                                    <p>Monday • 3:00 PM - 5:00 PM</p>
                                </div>
                            </div>
                            <div class="school-toggle">
                                <i class="fa-solid fa-chevron-down"></i>
                            </div>
                        </div>
                        <div class="school-schedules">
                            <div class="school-schedules-inner">
                                <label class="custom-checkbox">
                                    <input type="checkbox" name="schedule" value="Sin Ming - Mon (3-5pm)">
                                    <span class="custom-checkbox-label">
                                        <strong>Regular Training</strong><br>
                                        Monday • 3:00 PM - 5:00 PM
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- School Box 5 -->
                    <div class="school-box" onclick="toggleSchoolBox(this)">
                        <div class="school-header">
                            <div class="school-info">
                                <div class="school-logo flex items-center justify-center bg-slate-100">
                                    <i class="fa-solid fa-location-dot text-slate-400 text-xl"></i>
                                </div>
                                <div class="school-text">
                                    <h3>Other Location 其他地点</h3>
                                    <p>Specify your preferred training arrangement</p>
                                </div>
                            </div>
                            <div class="school-toggle">
                                <i class="fa-solid fa-chevron-down"></i>
                            </div>
                        </div>
                        <div class="school-schedules">
                            <div class="school-schedules-inner">
                                <input type="text" id="schedule-other" class="w-full p-3 rounded-xl border border-slate-300 focus:border-amber-500 outline-none" placeholder="Please specify preferred schedule">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STEP 6: Parent & Signature -->
            <div id="step-6" class="step-content">
                <h2 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                    <i class="fa-solid fa-file-signature text-amber-500"></i> 家长信息 Parent & Signature
                </h2>
                <div class="space-y-6">
                    <!-- Parent Info -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-slate-500 uppercase">Parent Name 家长姓名 *</label>
                            <input type="text" id="parent-name" class="w-full p-3 rounded-xl border border-slate-300 focus:border-amber-500 outline-none" placeholder="Parent Name" required>
                        </div>
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-slate-500 uppercase">Parent IC 家长身份证 *</label>
                            <input type="text" id="parent-ic" class="w-full p-3 rounded-xl border border-slate-300 focus:border-amber-500 outline-none" placeholder="000000-00-0000" maxlength="14" required>
                        </div>
                    </div>

                    <!-- Date -->
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-500 uppercase">Date 日期 *</label>
                        <input type="text" id="today-date" class="w-full p-3 rounded-xl border border-slate-300 bg-slate-100 outline-none" readonly>
                    </div>

                    <!-- Signature -->
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-500 uppercase">Signature 签名 *</label>
                        <div class="sig-box">
                            <canvas id="sig-canvas"></canvas>
                            <div id="sig-placeholder">SIGN HERE</div>
                        </div>
                        <button type="button" onclick="clearSig()" class="text-sm text-red-600 hover:underline mt-2">
                            <i class="fa-solid fa-eraser"></i> Clear Signature
                        </button>
                        <input type="hidden" id="signature-data">
                    </div>

                    <!-- Agreement -->
                    <div class="space-y-2">
                        <label class="custom-checkbox">
                            <input type="checkbox" id="agree" required>
                            <span class="custom-checkbox-label">
                                <strong>I agree to the terms and conditions</strong><br>
                                By checking this, I confirm the information provided is accurate.
                            </span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="flex justify-between mt-10">
                <button type="button" id="btn-prev" onclick="prevStep()" class="bg-slate-200 text-slate-700 px-8 py-2.5 rounded-xl font-semibold hover:bg-slate-300 transition">
                    <i class="fa-solid fa-arrow-left"></i> Previous
                </button>
                <button type="button" id="btn-next" onclick="nextStep()" class="bg-slate-900 text-white px-8 py-2.5 rounded-xl font-semibold shadow-lg shadow-slate-300 hover:bg-slate-800 transition">
                    Next Step <i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>

        </form>

        <!-- Success Screen -->
        <div id="success-screen" class="hidden text-center py-16">
            <div class="text-6xl text-green-500 mb-6">
                <i class="fa-solid fa-circle-check"></i>
            </div>
            <h2 class="text-2xl font-bold text-slate-800 mb-3">Registration Submitted!</h2>
            <p class="text-slate-600 mb-8">Thank you for registering. Your form has been successfully submitted.</p>
            <button onclick="submitAnother()" class="bg-amber-500 text-white px-8 py-3 rounded-xl font-semibold hover:bg-amber-600 transition">
                Submit Another Registration
            </button>
        </div>

    </div>
</div>

<!-- PDF Templates -->
<div id="pdf-template-page1">
    <!-- PDF content will be injected here -->
</div>
<div id="pdf-template-page2">
    <!-- PDF content will be injected here -->
</div>

<script>
    let currentStep = 1;
    const totalSteps = 6;
    let registrationData = null;

    // Initialize date
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('today-date').value = new Date().toLocaleDateString('en-GB');
        setupSignature();
        setupFormLogic();
    });

    function setupFormLogic() {
        // School other toggle
        document.getElementById('school').addEventListener('change', function() {
            const otherInput = document.getElementById('school-other');
            if (this.value === 'Others') {
                otherInput.classList.remove('hidden');
                otherInput.required = true;
            } else {
                otherInput.classList.add('hidden');
                otherInput.required = false;
                otherInput.value = '';
            }
        });

        // Status other toggle
        document.querySelectorAll('input[name="status"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const otherInput = document.getElementById('status-other');
                if (this.value === 'Others 其他') {
                    otherInput.classList.remove('hidden');
                    otherInput.required = true;
                } else {
                    otherInput.classList.add('hidden');
                    otherInput.required = false;
                    otherInput.value = '';
                }
            });
        });

        // IC formatting + age calc
        document.getElementById('ic').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 6) value = value.slice(0,6) + '-' + value.slice(6);
            if (value.length > 9) value = value.slice(0,9) + '-' + value.slice(9,13);
            e.target.value = value;
            calculateAge(value);
        });

        // Phone formatting
        document.getElementById('phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.startsWith('011')) {
                if (value.length > 3) value = value.slice(0,3) + '-' + value.slice(3);
                if (value.length > 8) value = value.slice(0,8) + ' ' + value.slice(8,12);
            } else {
                if (value.length > 3) value = value.slice(0,3) + '-' + value.slice(3);
                if (value.length > 7) value = value.slice(0,7) + ' ' + value.slice(7,11);
            }
            e.target.value = value;
        });

        // Parent IC formatting
        document.getElementById('parent-ic').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 6) value = value.slice(0,6) + '-' + value.slice(6);
            if (value.length > 9) value = value.slice(0,9) + '-' + value.slice(9,13);
            e.target.value = value;
        });
    }

    function calculateAge(icValue) {
        const ic = icValue.replace(/-/g, '');
        if (ic.length >= 6) {
            const year = parseInt(ic.substring(0,2));
            const month = parseInt(ic.substring(2,4));
            const day = parseInt(ic.substring(4,6));
            const fullYear = year > 25 ? 1900 + year : 2000 + year;
            const birthDate = new Date(fullYear, month - 1, day);
            const age = 2026 - birthDate.getFullYear();
            document.getElementById('age').value = age;
        }
    }

    function nextStep() {
        if (!validateStep(currentStep)) return;

        if (currentStep < totalSteps) {
            document.getElementById(`step-${currentStep}`).classList.remove('active');
            currentStep++;
            document.getElementById(`step-${currentStep}`).classList.add('active');
            updateUI();
        } else {
            submitForm();
        }
    }

    function prevStep() {
        if (currentStep > 1) {
            document.getElementById(`step-${currentStep}`).classList.remove('active');
            currentStep--;
            document.getElementById(`step-${currentStep}`).classList.add('active');
            updateUI();
        }
    }

    function updateUI() {
        const progress = (currentStep / totalSteps) * 100;
        document.getElementById('progress-bar').style.width = `${progress}%`;
        document.getElementById('step-counter').innerHTML = `0${currentStep}<span style="color: #475569; font-size: 14px;">/06</span>`;

        // Update buttons
        const prevBtn = document.getElementById('btn-prev');
        prevBtn.disabled = currentStep === 1;
        prevBtn.style.opacity = currentStep === 1 ? '0' : '1';

        const nextBtn = document.getElementById('btn-next');
        if (currentStep === totalSteps) {
            nextBtn.innerHTML = 'Submit <i class="fa-solid fa-paper-plane"></i>';
            nextBtn.className = "bg-amber-500 text-white px-8 py-2.5 rounded-xl font-semibold shadow-lg shadow-amber-200 hover:bg-amber-600 transition";
        } else {
            nextBtn.innerHTML = 'Next Step <i class="fa-solid fa-arrow-right"></i>';
            nextBtn.className = "bg-slate-900 text-white px-8 py-2.5 rounded-xl font-semibold shadow-lg shadow-slate-300 hover:bg-slate-800 transition";
        }

        // Scroll to top of form
        document.querySelector('.custom-scroll').scrollTop = 0;
    }

    function validateStep(step) {
        const currentStepEl = document.getElementById(`step-${step}`);
        const inputs = currentStepEl.querySelectorAll('input[required], select[required]');
        for (let input of inputs) {
            if (!input.value.trim()) {
                Swal.fire({
                    icon: 'error',
                    title: 'Missing Required Fields',
                    text: 'Please fill in all required fields before continuing.'
                });
                return false;
            }
        }

        // Special validation for events
        if (step === 4) {
            const checkedEvents = document.querySelectorAll('input[name="events"]:checked');
            if (checkedEvents.length === 0) {
                Swal.fire({
                    icon: 'error',
                    title: 'Select at least one event',
                    text: 'Please choose at least one competition event.'
                });
                return false;
            }
        }

        // Special validation for schedule
        if (step === 5) {
            const checkedSchedule = document.querySelectorAll('input[name="schedule"]:checked');
            const scheduleOther = document.getElementById('schedule-other').value.trim();
            if (checkedSchedule.length === 0 && !scheduleOther) {
                Swal.fire({
                    icon: 'error',
                    title: 'Select a schedule',
                    text: 'Please select at least one training schedule or specify another option.'
                });
                return false;
            }
        }

        // Signature validation
        if (step === 6) {
            const signature = document.getElementById('signature-data').value;
            if (!signature) {
                Swal.fire({
                    icon: 'error',
                    title: 'Signature required',
                    text: 'Please provide a signature before submitting.'
                });
                return false;
            }
        }

        return true;
    }

    function setupSignature() {
        const canvas = document.getElementById('sig-canvas');
        const box = canvas.parentElement;
        const ctx = canvas.getContext('2d');
        let drawing = false;
        let lastX = 0;
        let lastY = 0;

        function resizeCanvas() {
            const rect = box.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#111827';
        }

        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        function startDraw(e) {
            drawing = true;
            const pos = getPos(e);
            lastX = pos.x;
            lastY = pos.y;
            document.getElementById('sig-placeholder').style.display = 'none';
        }

        function draw(e) {
            if (!drawing) return;
            e.preventDefault();
            const pos = getPos(e);
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            lastX = pos.x;
            lastY = pos.y;
            document.getElementById('signature-data').value = canvas.toDataURL('image/png');
        }

        function endDraw() {
            drawing = false;
        }

        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return { x: clientX - rect.left, y: clientY - rect.top };
        }

        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', endDraw);
        canvas.addEventListener('mouseout', endDraw);

        canvas.addEventListener('touchstart', startDraw);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', endDraw);
    }

    function clearSig() {
        const canvas = document.getElementById('sig-canvas');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        document.getElementById('signature-data').value = '';
        document.getElementById('sig-placeholder').style.display = 'flex';
    }

    function gatherFormData() {
        const events = Array.from(document.querySelectorAll('input[name="events"]:checked'))
            .map(cb => cb.value);
        const scheduleChecked = Array.from(document.querySelectorAll('input[name="schedule"]:checked'))
            .map(cb => cb.value);
        const scheduleOther = document.getElementById('schedule-other').value.trim();
        const schedule = scheduleOther ? scheduleChecked.concat([scheduleOther]) : scheduleChecked;

        const statusRadio = document.querySelector('input[name="status"]:checked');
        let status = statusRadio ? statusRadio.value : '';
        if (status === 'Others 其他') {
            status = document.getElementById('status-other').value.trim();
        }

        const school = document.getElementById('school').value === 'Others'
            ? document.getElementById('school-other').value.trim()
            : document.getElementById('school').value;

        return {
            name_cn: document.getElementById('name-cn').value.trim(),
            name_en: document.getElementById('name-en').value.trim(),
            ic: document.getElementById('ic').value.trim(),
            age: document.getElementById('age').value.trim(),
            school: school,
            phone: document.getElementById('phone').value.trim(),
            email: document.getElementById('email').value.trim(),
            status: status,
            level: document.getElementById('level').value.trim(),
            events: events,
            schedule: schedule,
            parent_name: document.getElementById('parent-name').value.trim(),
            parent_ic: document.getElementById('parent-ic').value.trim(),
            date: document.getElementById('today-date').value.trim(),
            signature: document.getElementById('signature-data').value
        };
    }

    async function submitForm() {
        if (!validateStep(6)) return;

        const data = gatherFormData();
        registrationData = data;

        // Save registration data
        await saveRegistration(data);

        // Generate PDF
        await generatePDF(data);

        // Show success
        document.getElementById('regForm').style.display = 'none';
        document.getElementById('success-screen').classList.remove('hidden');

        // Optional: send email/notification here
        Swal.fire({
            icon: 'success',
            title: 'Registration Complete!',
            text: 'Your registration has been saved and PDF downloaded.'
        });
    }

    async function generatePDF(data) {
        // Create PDF templates
        document.getElementById('pdf-template-page1').innerHTML = createPDFPage1(data);
        document.getElementById('pdf-template-page2').innerHTML = createPDFPage2(data);

        // Wait for images to load
        await new Promise(resolve => setTimeout(resolve, 500));

        // Fill Page 1 data
        const namePlain = data.name_en;
        document.getElementById('pdf-name').innerText = data.name_en;
        document.getElementById('pdf-name-cn').innerText = data.name_cn;
        document.getElementById('pdf-ic').innerText = data.ic;
        document.getElementById('pdf-age').innerText = data.age;
        document.getElementById('pdf-school').innerText = data.school;
        document.getElementById('pdf-status').innerText = data.status;
        document.getElementById('pdf-phone').innerText = data.phone;
        document.getElementById('pdf-email').innerText = data.email;
        document.getElementById('pdf-level').innerText = data.level;
        document.getElementById('pdf-events').innerText = data.events.join(', ');
        document.getElementById('pdf-schedule').innerText = data.schedule.join(', ');
        document.getElementById('pdf-parent-name').innerText = data.parent_name;
        document.getElementById('pdf-parent-ic').innerText = data.parent_ic;
        document.getElementById('pdf-date').innerText = data.date;
        document.getElementById('pdf-sig-img').src = data.signature;

        // Fill Page 2 data
        document.getElementById('pdf-parent-name-2').innerText = data.parent_name;
        document.getElementById('pdf-parent-ic-2').innerText = data.parent_ic;
        document.getElementById('pdf-date-2').innerText = data.date;

        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');

        // Capture Page 1
        const page1 = document.getElementById('pdf-template-page1');
        page1.style.visibility = 'visible';

        const canvas1 = await html2canvas(page1, {
            scale: 2,
            useCORS: true,
            width: 794,
            height: 1123,
            logging: false
        });

        const imgData1 = canvas1.toDataURL('image/jpeg', 0.95);
        const pdfWidth = 210;
        const pdfHeight = 297;
        pdf.addImage(imgData1, 'JPEG', 0, 0, pdfWidth, pdfHeight);

        page1.style.visibility = 'hidden';

        // Capture Page 2
        const page2 = document.getElementById('pdf-template-page2');
        page2.style.visibility = 'visible';

        const canvas2 = await html2canvas(page2, {
            scale: 2,
            useCORS: true,
            width: 794,
            height: 1123,
            logging: false
        });

        const imgData2 = canvas2.toDataURL('image/jpeg', 0.95);
        pdf.addPage();
        pdf.addImage(imgData2, 'JPEG', 0, 0, pdfWidth, pdfHeight);

        page2.style.visibility = 'hidden';

        // Save PDF
        pdf.save(`${namePlain || 'Registration'}_Signed_Agreement.pdf`);
    }

    async function saveRegistration(payload) {
        try {
            const res = await fetch('register.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const json = await res.json();
            if (!json.success) {
                console.error('Save failed', json.error);
            }
        } catch (err) {
            console.error('Save error', err);
        }
    }

    function submitAnother() {
        document.getElementById('regForm').reset();
        clearSig();
        registrationData = null;
        
        for (let i = 1; i <= totalSteps; i++) {
            document.getElementById(`step-${i}`).classList.remove('active');
        }
        
        currentStep = 1;
        document.getElementById('step-1').classList.add('active');
        
        document.getElementById('step-counter').innerHTML = `01<span class="text-slate-600 text-sm">/06</span>`;
        document.getElementById('progress-bar').style.width = '16.67%';
        
        document.getElementById('btn-prev').style.display = 'block';
        document.getElementById('btn-prev').disabled = true;
        document.getElementById('btn-prev').style.opacity = '0';
        
        document.getElementById('btn-next').style.display = 'block';
        document.getElementById('btn-next').innerHTML = 'Next Step <i class="fa-solid fa-arrow-right"></i>';
        document.getElementById('btn-next').className = "bg-slate-900 text-white px-8 py-2.5 rounded-xl font-semibold shadow-lg shadow-slate-300 hover:bg-slate-800 transition";
        
        document.getElementById('today-date').value = new Date().toLocaleDateString('en-GB');
        
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    function toggleSchoolBox(element) {
    // Prevent toggle when clicking on checkbox
    if (event.target.type === 'checkbox' || event.target.closest('.custom-checkbox')) {
        return;
    }
    
    element.classList.toggle('active');
}

</script>
</body>
</html>
